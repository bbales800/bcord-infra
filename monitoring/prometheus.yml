# =====================================================================
# üìä Prometheus Configuration for BCord Monitoring Stack
# ---------------------------------------------------------------------
# Author: BCord Chat Team
# Updated: 2025-10-28
#
# PURPOSE:
#   This configuration enables Prometheus to scrape metrics from:
#     ‚Ä¢ Prometheus itself (health, storage, CPU)
#     ‚Ä¢ BCord backend (status/availability probe + /metrics endpoint)
#     ‚Ä¢ Redis (via Redis Exporter)
#     ‚Ä¢ Grafana (dashboard engine metrics)
#
# NOTES:
#   - The Redis exporter provides HTTP metrics from Redis.
#   - The BCord backend now exposes a minimal Prometheus endpoint `/metrics`
#     returning `bcord_up 1` for status health.
# =====================================================================

global:
  # Scrape metrics every 15 seconds
  scrape_interval: 15s
  # Evaluate alerting rules every 15 seconds
  evaluation_interval: 15s
# =====================================================================
# üß† SCRAPE CONFIGURATIONS
# ---------------------------------------------------------------------
# Each job below defines a group of targets for Prometheus to poll.
# Targets are internal container hostnames (Docker service names).
# =====================================================================
scrape_configs:

  # --------------------------------------------------------------
  # üß© PROMETHEUS SELF-MONITORING
  # --------------------------------------------------------------
  - job_name: 'prometheus'
    metrics_path: /metrics
    static_configs:
      - targets: ['localhost:9090']

  # --------------------------------------------------------------
  # ‚öôÔ∏è BCORD BACKEND (C++ SERVICE)
  # --------------------------------------------------------------
  # Target: bcord-backend:9000
  # Purpose:
  #   - Confirms backend health and reachability via /metrics.
  #   - Expects text/plain output: "bcord_up 1"
  # --------------------------------------------------------------
  - job_name: 'bcord'
    metrics_path: /metrics      # ‚úÖ Now scraping the proper endpoint
    static_configs:
      - targets: ['bcord-backend:9000']
  # --------------------------------------------------------------
  # üßÆ REDIS EXPORTER (PROMETHEUS BRIDGE)
  # --------------------------------------------------------------
  - job_name: 'redis'
    static_configs:
      - targets: ['bcord-redis-exporter:9121']

  # --------------------------------------------------------------
  # üìà GRAFANA DASHBOARD ENGINE
  # --------------------------------------------------------------
  - job_name: 'grafana'
    static_configs:
      - targets: ['bcord-grafana:3000']
# =====================================================================
# üßæ ALERT RULES (OPTIONAL)
# ---------------------------------------------------------------------
# To enable alerts, create /srv/bcord/monitoring/alerts.yml and
# define alert rules, then uncomment this section.
# Example:
#   rule_files:
#     - "alerts.yml"
# =====================================================================
rule_files:
  - "alerts.yml"

